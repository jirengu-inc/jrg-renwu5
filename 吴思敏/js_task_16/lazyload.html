<!DOCTYPE html>
<html>
<head>
	<title>懒加载</title>
	<meta charset="utf-8">
	<style type="text/css">

    ul,li{
      list-style:none;
    }
    .container{
      width: 600px;
      margin: 0 auto;
    }
    .container li{
      float: left;
      margin: 10px 10px;
    }
    .container li img{
      width: 240px;
      height: 180px;
    }
    p{
      float: left;
    }
  
	</style>
</head>
<body>
<ul class="container">
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/1.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/2.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/3.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/4.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/5.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/6.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/7.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/8.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/9.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/10.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/11.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/12.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/13.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/14.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/15.jpg">
		</a>
	</li>
	<li>
		<a href="#">
			<img src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg" data-src="http://cdn.jirengu.com/book.jirengu.com/img/16.jpg">
		</a>
	</li>
	
</ul>
<script src="http://apps.bdimg.com/libs/jquery/1.9.1/jquery.js"></script>
<script>


/*
1. 对于所有的 img 标签，把真实的地址放入自定义属性data-img
2. 当滚动页面时，检查页面所有的 img 标签，看看这个标签是否出现到我们的视野，当出现在我们的视野时，再去判断它是否已经加载过，如果没有加载过，加载它


*/


lazyRender()

var clock
$(window).on('scroll', function(){
  if(clock){
    clearTimeout(clock)
  }
  clock = setTimeout(function(){
    console.log('hello')
    lazyRender()
  }, 100)

})

function lazyRender() {
  $('.container img').each(function(){
    if( checkShow($(this)) && !isLoaded($(this)) ){
      loadImg($(this))
    }
  }) 
}

function checkShow($img) {
  var scrollTop = $(window).scrollTop()
  var windowHeight = $(window).height()
  var offsetTop = $img.offset().top
  if(offsetTop < scrollTop + windowHeight && offsetTop > scrollTop) {
    return true
  }
  return false
}

function isLoaded($img) {
  return $img.attr('data-src') === $img.attr('src')
}

function loadImg($img){
  $img.attr('src', $img.attr('data-src'))
}











/*


  var clock;
	$(window).on('scroll', function(){

    //用户鼠标滚轮滚动一次，有多次事件响应。下面的 setTimeout 主要是为性能考虑，只在最后一次事件响应的时候执行 checkshow
    if(clock){
      clearTimeout(clock);
    }
    clock = setTimeout(function(){
      console.log(1);
      checkShow();
    }, 300);

	});

  // 用户第一次打开页面，还未滚动窗口的时候需要执行一次 checkShow
	checkShow();

	function checkShow(){
		$('.container img').each(function(){
			var $cur = $(this);
      if($cur.attr('isLoaded')){
        return;
      }

			if(isShow($cur)){
					showImg($cur);
			}
		});
	}

	function isShow($el){
	  var scrollH = $(window).scrollTop(),
	  	  winH = $(window).height(),
	  	  top = $el.offset().top;

  	  if(top < winH + scrollH){
  	  	return true;
  	  }else{
  	  	return false;
  	  }
	}

	function showImg($el){
      $el.attr('src', $el.attr('data-src'));
      $el.attr('isLoaded', true);
	}

*/

</script>
</body>
</html>